"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var Document = require('../Document');

var sumBy = require('lodash/sumBy');

var BankAccountStats =
/*#__PURE__*/
function (_Document) {
  (0, _inherits2.default)(BankAccountStats, _Document);

  function BankAccountStats() {
    (0, _classCallCheck2.default)(this, BankAccountStats);
    return (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(BankAccountStats).apply(this, arguments));
  }

  (0, _createClass2.default)(BankAccountStats, null, [{
    key: "checkCurrencies",
    value: function checkCurrencies(accountsStats) {
      var currency = accountsStats[0].currency;
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = accountsStats[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var accountStats = _step.value;

          if (accountStats.currency !== currency) {
            return false;
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return != null) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      return true;
    }
  }, {
    key: "sum",
    value: function sum(accountsStats) {
      if (accountsStats.length === 0) {
        throw new Error('You must give at least one stats object');
      }

      if (!this.checkCurrencies(accountsStats)) {
        throw new Error('Currency of all stats object must be the same.');
      }

      var properties = ['income', 'additionalIncome', 'mortgage', 'loans', 'fixedCharges'];
      var summedStats = properties.reduce(function (sums, property) {
        sums[property] = sumBy(accountsStats, function (accountStats) {
          return accountStats[property] || 0;
        });
        return sums;
      }, {});
      summedStats.currency = accountsStats[0].currency;
      return summedStats;
    }
  }]);
  return BankAccountStats;
}(Document);

BankAccountStats.doctype = 'io.cozy.bank.accounts.stats';
BankAccountStats.idAttributes = ['_id'];
BankAccountStats.version = 1;
BankAccountStats.checkedAttributes = null;
module.exports = BankAccountStats;